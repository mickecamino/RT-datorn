10 Y=84
20 DIM H$(365)
30 GOTO 180
40 REM ** ERROR-RUTIN  **
50 IF ERR=2 THEN PRINT "Filen redan |ppnad"
60 IF ERR=4 THEN PRINT "Filen existerar ej"
70 IF ERR=7 THEN PRINT "Skiva {r fylld"
80 PRINT "Fel"; ERR;" p} rad";ERL
90 REM ** SLUT ERROR-RUTIN **
100 RESUME 180
110 REM ** SUBRUTIN F\R DEFINITION **
120 REM ** AV LAGRINGSFILENS F[LT **
130 REM ** INDELNING.             **
140 REM
150 FIELD #1, R*18 AS Z$, 6 AS D$, 8 AS R$, 4 AS B$
160 REM ** SLUT SUBRUTIN          **
170 RETURN
180 PRINT : PRINT "    MENY"
190 PRINT
200 PRINT "1. Inmatning"
210 PRINT "2. Listning"
220 PRINT "3. Summering"
230 PRINT "4. [ndring"
240 PRINT "9. Avsluta"
250 PRINT : INPUT "V{lj siffra ";S
260 IF S<1 OR S>9 GOTO 180
270 ON S GOSUB 290,920,1180,3760,4170,4180,4190,4195,4200
280 GOTO 180
290 REM ** SUBRUTIN  INMATNING **
300 REM **                     **
310 OPEN OLD "UTG.DAT" AS 1
320 ON ERROR GOTO 670
330 R=0
340 GOSUB 140
350 GET #1,RECORD 1
360 A=VAL(D$)
370 SE=INT(A/14+.94)
380 R=A-(SE-1)*14
390 REM
400 IF R<=13 THEN 480
410 SE=SE+1
420 FOR R=0 TO 13
430 LSET D$="" : LSET R$="" : LSET B$=""
440 PUT #1, RECORD SE+1
450 NEXT R
460 R=0
470 PUT #1, RECORD SE
480 PRINT "Ge datum (ex. 840909) S=Slut"
490 INPUT D1$
500 IF D1$="S" OR D1$="s" GOTO 820
510 IF VAL(RIGHT$(D1$,2)) > 31 OR VAL(RIGHT$(D1$,2)) < 1 THEN 480
520 IF VAL(MID$(D1$,3,2)) > 12 OR VAL(MID$(D1$,3,2)) < 1 THEN 480
530 PRINT "Skriv postrubrik (Max 8 tecken)"
540 INPUT R1$
550 IF LEN(R1$) > 8 GOTO 530
560 PRINT "Ge belopp (1-9999)"
570 INPUT B1$
580 IF VAL(B1$)> 9999 OR VAL(B1$) < 1 THEN 560
590 GOSUB 140
600 GET #1, RECORD SE
610 LSET D$=D1$
620 LSET R$=R1$
630 LSET B$=B1$
640 PUT #1, RECORD SE
650 R=R+1
660 GOTO 390
670 IF ERR<>4 THEN 40
680 PRINT : PRINT "Skapar en ny fil !"
690 CLOSE 1
700 OPEN NEW "UTG.DAT" AS 1
710 R=0
720 GOSUB 140
730 LSET D$=STR$(1)
740 PUT #1, RECORD 1
750 FOR R=0 TO 13
760 LSET D$="" : LSET R$="" : LSET B$=""
770 PUT #1, RECORD 2
780 NEXT R
790 R=0
800 A=1
810 GOTO 370
820 REM ** AVSLUTNING AV INMATNING **
830 RE=R : R=0
840 AN=(SE-1)*14+RE
850 GOSUB 140
860 GET #1, RECORD 1
870 LSET D$=STR$(AN)
880 PUT #1, RECORD 1
890 CLOSE 1
900 REM ** SLUT SUBRUTIN INMATNING **
910 RETURN
920 REM ** SUBRUTIN LISTNING **
930 PRINT CHR$(27);CHR$(5);"  LISTNING"
940 OPEN OLD "UTG.DAT" AS 1
950 ON ERROR GOTO 1140
960 R=0
970 GOSUB 140
980 GET #1, RECORD 1
990 PRINT :PRINT "Dat.";TAB(12);"Post";TAB(22);"Belopp"
1000 R=VAL(D$)
1010 R1=R
1020 SE=INT(R/14+.93)
1030 PRINT
1040 FOR J=1 TO SE
1050 IF J=SE THEN RE=R1-1-(SE-1)*14 ELSE RE=13
1060 FOR I=0 TO RE
1070 IF J=1 AND I=0 THEN 1110
1080 R=I : GOSUB 140
1090 GET #1, RECORD J
1100 PRINT D$;TAB(12);R$;TAB(23);B$
1110 NEXT I
1120 NEXT J
1130 GOTO 1150
1140 GOSUB 40
1150 CLOSE 1
1160 REM ** SLUT SUBRUTIN LISTNING **
1170 RETURN
1180 REM ** SUMMERING **
1190 PRINT CHR$(27);CHR$(5);"SUMMERING"
1200 PRINT : PRINT
1210 PRINT "1. Enbart totala summan"
1220 PRINT "2. Summan av lika poster - ALLA"
1230 PRINT "3. Summan av lika poster - VISSA"
1240 PRINT "4. Slut summering"
1250 S=0
1260 PRINT : INPUT "Siffra ";W
1270 IF W>4 OR W<1 THEN 1260
1280 IF W=4 GOTO 1320
1290 ON W GOSUB 1880, 2320, 3020
1300 REM ** SLUT SUBRUTIN SUMMERING **
1310 GOTO 1200
1320 RETURN
1330 REM ** subrutin f|r inmatning **
1340 REM ** av intervall           **
1350 REM ** TILLDELAR F1 och A1   **
1360 PRINT : PRINT "Skriv f|rsta datumet i intervallet"
1370 INPUT F
1380 IF VAL(LEFT$(STR$(F),3)) < 84 OR VAL(LEFT$(STR$(F),3)) > 84 THEN 1360
1390 IF VAL(MID$(STR$(F),4,2)) <1 OR VAL(MID$(STR$(F),4,2)) >12 THEN 1360
1400 IF VAL(RIGHT$(STR$(F),3)) <1 OR VAL(RIGHT$(STR$(F),3)) >31 THEN 1360
1410 PRINT : PRINT "Skriv andra datumet"
1420 INPUT A
1430 IF VAL(LEFT$(STR$(A),3)) < 1 OR VAL(LEFT$(STR$(A),3)) > Y THEN 1410
1440 IF VAL(MID$(STR$(A),4,2)) <1 OR VAL(MID$(STR$(A),4,2)) >12 THEN 1410
1450 IF VAL(RIGHT$(STR$(A),3)) <1 OR VAL(RIGHT$(STR$(A),3)) >31 THEN 1410
1460 IF A<F THEN 1410
1470 OPEN OLD "UTG.DAT" AS 1
1480 ON ERROR GOTO 1820
1490 R=0
1500 GOSUB 140
1510 GET #1, RECORD 1
1520 AN=VAL(D$)
1530 IF AN<10 GOTO 1540
1540 SE=INT(AN/14+.94)
1550 FOR I=1 TO SE
1560 IF I=SE THEN RE=AN-1-(SE-1)*14 ELSE RE=13
1570 FOR R=0 TO RE
1580 IF I=1 AND R=0 THEN 1620
1590 GOSUB 140
1600 GET #1, RECORD I
1610 IF F=VAL(D$) THEN 1660
1620 NEXT R
1630 NEXT I
1640 PRINT "Inget s} sent datum"
1650 GOTO 1860
1660 F1=I
1670 R1=R
1680 FOR I=F1 TO SE
1690 IF I=F1 THEN ST=R1 ELSE ST=0
1700 IF I=SE THEN RE=AN-1-(SE-1)*14 ELSE RE=13
1710 FOR R=ST TO RE
1720 GOSUB 140
1730 GET #1, RECORD I
1740 IF A=VAL(D$) THEN 1790
1750 NEXT R
1760 NEXT I
1770 PRINT "ingen A1"
1780 GOTO 1860
1790 A1=I
1800 R2=R
1810 GOTO 1860
1820 REM ** ANROPA ERROR-RUTIN **
1830 GOSUB 40
1840 REM ** slut subrutin f|r *
1850 REM ** inmatning av interv. **
1860 CLOSE 1
1870 RETURN
1880 REM ** SUBRUTIN F\R TOTALA **
1890 REM ** SUMMAN              **
1900 PRINT CHR$(27);CHR$(5)
1910 PRINT "Totala summan"
1920 REM ** ANROPA SUBRUTIN F\R **
1930 REM ** TILLDELNING AV VAR. **
1940 REM ** F1 och A1           **
1950 GOSUB 1330
1960 OPEN OLD "UTG.DAT" AS 1
1970 ON ERROR GOTO 2250
1980 FL=0
1985 S=0
1990 FOR K=F1 TO A1
2000 K1=K
2010 REM ** H[MTA RS & RF  **
2020 GOSUB 2050
2030 GOTO 2160
2040 REM ** SUBRUTIN F\R RF & RS **
2050 IF F1<>A1 THEN 2080
2060 RF=R1 : RS=R2
2070 GOTO 2150
2080 IF K1<>F1 THEN 2110
2090 RF=R1 : RS=13
2100 GOTO 2150
2110 IF K1=A1 THEN 2140
2120 RF=0 : RS=13
2130 GOTO 2150
2140 RF=0 : RS=R2
2150 RETURN
2160 FOR R=RF TO RS
2170 GOSUB 140
2180 GET #1 ,RECORD K
2190 S=S+VAL(B$)
2200 NEXT R
2210 NEXT K
2215 IF FL=1 THEN 2300
2220 PRINT
2230 PRINT "Totala summan = ";S
2240 GOTO 2270
2250 REM ** ANROP AERROR-RUTIN **
2260 GOSUB 40
2270 REM
2280 REM ** SLUT SUBRUTIN SUMMERING **
2290 REM ** AV SAMTLIGA POSTER      **
2300 CLOSE 1
2310 RETURN
2320 REM ** SUBRUTIN F\R SUMMAN   **
2330 REM ** AV ALLA LIKA POSTER   **
2340 PRINT CHR$(27);CHR$(5)
2350 PRINT "Summan av alla lika poster"
2360 PRINT
2370 REM ** anropa subrutin som *
2380 REM ** ger parametrarna F1 *
2390 REM ** och A1, samt R1 & R2 **
2400 GOSUB 1360
2430 PRINT
2440 PRINT "Post","Summa"
2450 PRINT
2460 OPEN OLD "UTG.DAT" AS 1
2470 ON ERROR GOTO 2950
2480 R=0 : GOSUB 140
2490 GET #1, RECORD 1
2500 AN=VAL(D$)-1
2510 IF AN<365 GOTO 2540
2520 PRINT "f|r stort intervall !"
2530 GOTO 3090
2540 SE=INT(AN/14+.94)
2550 FOR I=0 TO AN
2560 H$(I)=""
2570 NEXT I
2580 S=0
2590 H=0
2600 FOR K=F1 TO A1
2610 REM ** H[MTA RS & RF    **
2620 K1=K
2630 GOSUB 2050
2640 FOR RG=RF TO RS
2650 R=RG
2660 GOSUB 140
2670 GET #1, RECORD K
2680 R1$=R$
2690 FOR M=0 TO H
2700 IF R1$=H$(M) THEN 2910
2710 NEXT M
2720 REM ** R$ finns inte i H$ **
2730 REM ** allts} ej printad. **
2740 REM ** D} printar vi den d} **
2750 FOR L=F1 TO A1
2760 REM ** h{mta RS & RF  **
2770 K1=L
2780 GOSUB 2050
2790 FOR RE=RF TO RS
2800 R=RE
2810 GOSUB 140
2820 GET #1, RECORD L
2830 IF R1$<>R$ THEN 2860
2840 S=S+VAL(B$)
2850 H$(H)=R$
2860 NEXT RE
2870 NEXT L
2880 H=H+1
2890 PRINT R1$, S
2900 S=0
2910 NEXT RG
2920 NEXT K
2930 GOSUB 1980
2940 GOTO 2970
2950 REM ** ANROPA ERROR-RUTIN **
2960 GOSUB 40
2970 PRINT : PRINT
2980 REM ** SLUT SUBRUTIN F\R **
2990 REM ** SUMMERING ALLA LIKA **
3000 REM ** POSTER.             **
3010 RETURN
3020 REM ** SUMMERING AV VISSA POSTER **
3030 REM ** ANROPA SUBRUTIN F\R   **
3040 REM ** TILLDELNING AV        **
3050 REM ** A1, F1, R1 & R2       **
3060 GOSUB 1360
3070 OPEN OLD "UTG.DAT" AS 1
3080 ON ERROR GOTO 3700
3090 R=0 : GOSUB 130
3100 GET #1, RECORD 1
3110 AN=VAL(D$)
3120 IF AN < 365 THEN 3150
3130 PRINT "F|r stort intervall !"
3140 GOTO 3720
3150 SE=INT(AN/14+.94)
3160 H=0
3170 INPUT "Skriv post (S=Stopp)";H$(H)
3180 IF H$(H)="S" OR H$(H)="s" THEN 3210
3190 H=H+1
3200 GOTO 3170
3210 H=H-1
3220 PRINT : PRINT "Post","Summa ": PRINT
3230 PRINT
3235 S1=0
3240 FOR K=F1 TO A1
3250 REM ** H[MTA RS & RF  **
3350 K1=K
3360 GOSUB 2050
3370 FOR RG=RF TO RS
3380 R=RG
3390 GOSUB 140
3400 GET #1, RECORD K
3430 R1$=R$
3440 FOR M=0 TO H
3450 IF R1$=H$(M) THEN 3490
3460 NEXT M
3480 GOTO 3650
3490 H$(M)=""
3500 FOR L=F1 TO A1
3510 REM ** H[MTA RS & RF  **
3520 K1=L
3530 GOSUB 2050
3540 FOR RE=RF TO RS
3550 R=RE
3560 GOSUB 140
3570 GET #1, RECORD L
3580 IF R1$<>R$ THEN 3600
3590 S=S+VAL(B$)
3600 NEXT RE
3610 NEXT L
3620 PRINT R1$,S
3624 S1=S1+S
3630 S=0
3640 REM
3650 NEXT RG
3660 NEXT K
3662 FL=1
3664 GOSUB 1985
3670 PRINT "\vrigt",S-S1
3680 PRINT : PRINT "Totala summan =";S
3690 GOTO 3740
3700 IF ERR<> 4 THEN 50
3710 PRINT "Filen existerar ej !"
3720 CLOSE 1
3730 RESUME 180
3740 REM ** SLUT SUM VISSA POSTER  **
3750 RETURN
3760 REM ** [NDRING  **
3770 INPUT "Viket datum vill du {ndra";D
3780 IF VAL(LEFT$(STR$(D),3)) <1 OR VAL(LEFT$(STR$(D),3)) >Y THEN 3770
3790 IF VAL(MID$(STR$(D),4,2)) <1 OR VAL(MID$(STR$(D),4,2)) >12 THEN 3760
3800 IF VAL(RIGHT$(STR$(D),3)) <1 OR VAL(RIGHT$(STR$(D),3)) >31 THEN 3770
3810 OPEN OLD "UTG.DAT" AS 1
3820 ON ERROR GOTO 4120
3830 R=0 : GOSUB 130
3840 GET #1 , RECORD 1
3850 AN=VAL(D$)
3860 SE=INT(AN/14+.94)
3870 PRINT
3880 FOR I=1 TO SE
3890 IF I=1 THEN RF=1 ELSE RF=0
3900 IF I=SE THEN RS=AN-1-(SE-1)*14 ELSE RS=13
3910 FOR R=RF TO RS
3920 GOSUB 130
3930 GET #1, RECORD I
3940 IF VAL(D$)=D THEN 3990
3950 NEXT R
3960 NEXT I
3970 PRINT "Datumet finns ej !"
3980 GOTO 4150
3990 PRINT "Postrubrik"
4000 PRINT "Gammalt:";R$;" Nytt:";
4010 INPUT R1$
4020 IF LEN(R1$)>8 THEN 4000
4030 PRINT "Belopp"
4040 PRINT "Gammalt:";B$;" Nytt:";
4050 INPUT B1$
4060 IF VAL(B1$)>9999 THEN 4040
4070 LSET R$=R1$
4080 LSET B$=B1$
4090 GOSUB 130
4100 PUT #1, RECORD I
4110 GOTO 4150
4120 IF ERR<>4 THEN 40
4130 PRINT "Filen existerar ej !"
4140 RESUME 180
4150 REM ** SLUT [NDRING  **
4160 CLOSE 1
4170 RETURN
4180 RETURN
4190 RETURN
4195 RETURN
4200 REM close
4210 END
