# Funktionsbeskrivning

- De tidigare avsnitten i denna serie har direkt syftat till en komplett dator med terminal av videotyp och flexskivesystem för högnivåspråk. 
- Den som är nybörjare vill förmodligen göra en mjukstart och börja med en billigare dator utan avancerad terminal och flexskiva. 
- I avsnittet beskriver vi därför ett litet periferikort som terminal för nybörjaren. Med det samt ett processorkort enligt RT 1979 12 , monterade på ett moder-kort, får man en liten dator som kan användas för utbildning och maskinkodsprogrammering. Funktionerna är i många avseenden samma som Motorolas D2-kit.  

Den som har tänkt att bygga en hobbydator enligt RT:s byggserie kommer snart underfund med att det fordras en terminal av något slag för att man skall kunna kommunicera med datorn. Terminalen kan vara en videoterminal med tangentbord och bildskärm eller en teletypemaskin av något slag. Båda typer är relativt dyra jämfört med de grundkomponenter som datorn består av. För att erbjuda en billigare grundvariant av datorn har ett nytt periferikort konstruerats. Det ger tillsammans med processorkortet, som beskrevs i RT 1979 nr 12, och moderkortet, som beskrevs i RT 1980 nr 1, en fungerande dator med ett litet tangentbord och sex lysdiodindikatorer. Funktionerna påminner starkt om Motorolas D2-kit, men det finns vissa förbättringar ifråga om expansionsmöjligheter och programhanteringen av tangenter och indikatorer. Indikatorkortet skall placeras i kontakten J15 på moderkortet. I sockeln IC34 på processorkortet placeras Eprom-kretsen med monitorprogrammet ECBUG och datorn är klar att användas.  

Med monitorprogrammet kan man ändra i minnesceller, beräkna offset för relativ adressering, lägga in brytpunkter, starta program och med ett anpassningskort för kassettspelare spela in och av data på en vanlig audiokassett. Det finns även en variant av monitorprogrammet för den som direkt vill arbeta med 6809-processorn. Monitorn kallas FOBUG och har samma kommandon som ECBUG. För att bruka datorn behövs till att börja med endast 1 k RAM på adress $A000-A3FF. 
## Periferikortets funktion 
Principschemat för det kombinerade indikator- och tangent-bordkortet återfinns i fig 1.  

För att ge en enkel programhantering och ökad användbarhet i andra tillämpningar än just terminalfunktionen används två specialkretsar från ***National Semiconductor***. Den ena kretsen har beteckningen MM74C917 och är en anpassningskrets för lysdiodindikatorer. På ena sidan av kretsen ansluts data och adress-signaler från mikroprocessorn och på den andra sidan sex lysdiodindikatorer av 7-segmenttyp. Kretsen innehåller minnen för de olika indikatorerna samt multiplexfunktion för att minska antalet förbindelser mellan indikatorerna och kretsen. Från mikroprocessorns synvinkel adresseras varje lysdiod-indikator som en minnescell av "write only"-typ. I kretsen sker hexadecimal avkodning av de fyra databitarna D0-D3 till de sju segmenten på indikatorerna. Databit 7 används för att tända decimalpunkten på varje indikator.  
I fig 2 finns blockschema för MM74C917 återgivet.  

Den andra specialkretsen har beteckningen MM74C923 och dess blockschema återfinns i fig 3.  

Till kretsen ansluts de 20 tangenterna i matrisform. IC2 är en avkodare, som ger varje funktion på kortet sin unika adress. De sex lysdiodindikatorerna har adresserna $80E0-80E5, data från tangentbordet hämtas på adress $80E6 och indikering på att någon tangent är nedtryckt finns på adress $80E8. De tre högsta adresserna $80EA, $80EC samt $80EE är lediga. I programmet ECBUG används dock utgången $80EE för att ge en puls till en "BELL"-krets av något slag. Tonsignaleringen används för att indikera fel i exempelvis "memory change"-rutinen.  

När någon tangent har tryckts ned, kommer utgången DA på IC3 att gå till hög nivå och ställa RS-vippan IC4 så att utgången på stift 3 blir hög. När processorn läser på adress $80E8, blir databit 7 låg, eftersom T7 fungerar som en grind. När basen är hög och emittern låg, blir kollektorn också låg. Adressen används vid test för att undersöka om någon tangent har tryckts ner. När data sedan hämtas kommer en läspuls på utgången stift 12 på IC2. Denna puls återställer RS-vippan IC4 och lägger ut värdet fran IC3 över dess ingång OE (output enable). På databussen får man då ett hexadecimalt tal mellan $E0 och $F3 eftersom de tre högsta databitarna alltid är "1".  

Kretskortet återfinns i skala 1:1 i fig 4 sett från komponentsidan, och komponentplaceringen återfinns i fig 5. Om man vill placera indikatorerna och tangenterna i en låda för sig, kapas kortet vid den heldragna linjen och de båda kortdelarna förbinds med flatkabel. På grund av att indikatorerna är multiplexade bör flatkabeln inte vara längre än 50-60 cm, eftersom störningar annars kan komma in på tangentbordkretsen IC3. Om kortet skall monteras odelat i den enklare datorlådan kan man ta upp ett hål i fronten och placera ett rött filter framför lysdiodindikatorerna. Av fig 5 framgår var de olika uppmärkta tangenterna skall lödas in. Först måste dock alla byglingar, markerade med vita linjer, lödas. Indikatorerna löds direkt på kretskortet. Vill man kunna byta dem, bör emellertid socklar användas. IC1 och IC3 är av MOS-typ och skall ej sättas i förrän alla andra komponenter är inlödda. När kortet är färdigmonterat kan man prova datorn. På moderkortet skall indikatorkortet placeras i en kontakt på position J15. Kortet vänds så att lödsidan är vänd åt kontaktposition J14. I någon av kontakterna J16-21 placeras ett processorkort med MC6808. I sockel IC34 placeras monitorprogrammet ECBUG och i socklarna IC10 och IC11 skall två 2114-kretsar sitta. Byglingarna "RAM-adress" på processorkortet kopplas för A-B, och alla fyra byglarna vid om-kopplaren S1 skall vara på plats. Omkopplaren S2 för vektorval kopplas för EC, dvs  den fjärde sektionen från vänster skall slås till. För den som skall använda MC 6809 gäller, att sektion fem (FO) också skall slås till. Monitorprogrammet för 6809 placeras i sockel IC26 och de båda kondensatorerna C1-2 samt kristallen X1 löds in innan IC36 sätts i hållaren. När spänningarna ansluts (+5, +12 och -12 V), skall de sex indikatorerna visa 0.00000 och decimalpunkten blinka långsamt på den första indikatorn. 
Monitorprogrammets funktioner 
De 20 tangenterna märkta 0-9 samt A, B, C, D, E, F, L, P, R och S används för att mata in hexadecimala tal för data och adresser samt för olika kommandon. För att ge en viss likhet med de monitorprogram vilka har en bildskärm som presentationsenhet har vissa funktioner införts för att förenkla handhavandet för användaren. Detta har även den fördelen, att det blir relativt lätt att vänja om sig vid senare övergång till en bildskärmsterminal. De fyra första indikatorerna används av monitorprogrammet för att visa adresser och andra 16-bitars tal. De två övriga används för att visa data och 8-bitars tal. Båda monitorprogrammen har samma kommandon och identiska egenskaper. Till varje monitorprogram medföljer en programlistning med kommentarer. När punkten på första indika-torn blinkar långsamt innebär det att programmet är i kontrollslingan och väntar på ett kommando. Det finns då åtta kommandon att välja mellan: 
- A, Alter Memory: 
Minnesmanipulering. Efter att ha tryckt pa A blinkar punkten med högre hastighet och det är nu bara att knappa in en 4-ställig hexadecimal adress till den minnescell man vill undersöka. Adressen visas på de fyra första indikatorerna och data i adressens minnescell på de två sista indikato-rerna. Nu finns det fyra vägar att fortsätta på: Om data skall ändras på den aktuella minnespositionen gör man så enbart genom att ange två hexadecimala tecken (0-9, A-F). Om det nya värdet fastnar i minnet, dvs  om det fanns RAM-minne på den adressen, visas det nya värdet ett kort ögonblick varefter programmet stegar vidare till efterföljande minnesposition och visar datainnehållet i den minnescellen. Inmatning av maskinkod från en lista blir på det sättet enkel. Om man bara vill undersöka vad som finns i de olika minnes-cellerna, kan man stega genom minnet med L-tangenten. Med P-tangenten kan man stega baklänges i minnet. För att återgå till kontrollslingan trycker man på R. Om man försöker ändra data på en adress där det inte finns något RAM; det kanske är ROM, EPROM eller ett "write only"-register i en periferikrets, ger datorn en BELL-puls och ingen ändring av minnesadressen sker. Det är användbart särskilt om man skall mata in olika tal i en periferikrets register för att prova dess utgångar. Med S-tangenten kan man på ett enkelt sätt beräkna offset för relativ adressering. Det är annars ett tidsödande arbete, speciellt vid handskrivna program i maskinkod. Om vi exempelvis befinner oss i minnesposition A200 med instruktionen 26 (BEQ), skall på den efterföljande minnespositionen stå offset-värdet till den adress dit vi skall hoppa, om föregående instruktion gav ett resultat som blev noll. Vi antar, att adressen är A1BE. På minnesposition A201 trycker vi på S-tangenten och knappar in adressen A1BE. På dataindikatorn står därefter BC, vilket är det uträknade 2-komplements offsettal som datorn behöver för att hamna på rätt adress vid programmets körning. Eftersom det uträknade och visade offsetvärdet skall läggas in på den angivna minnesadressen så gör programmet det åt oss, varefter nästa minnesadress med innehåll visas på indikatorerna. Problemet med 2-komplement-offset behöver inte längre bekymra den som gör program i maskinkod med funktionen. Om det skulle visa sig att den inmatade adressen ligger för långt ifrån, anges det med en BELL-puls utan ändring av minnesadressen. 
- B, Set Breakpoint: 
En brytpunkt är ett slags programstopp, vilket används under avlusning (eng "debugging") av program. Funktionen åstadkoms genom att man ersätter den ursprungliga opkoden med opkoden för SWI. När programmet kommer till SWI, avbryts det och registren skrivs ut (se nedan under R). Inläggning av SWI sker automatiskt vid E- eller C-kommando. Borttagning av SWI sker också automatiskt, såvida inte programmet avbryts med ett tryck på reset-knappen. I så fall får man för hand ändra de minnesceller som var försedda med brytpunkter. Maximalt fem brytpunkter kan samtidigt anges. En brytpunkt inmatas genom att man trycker på B och en adress. Efter det återgår programmet till kontrollslingan. 

- C, Continue: 
Används för att fortsätta efter en brytpunkt. När registren har visats och programmet är i kontrollslingan, trycker man på C. Stackpekaren laddas då med det ursprungliga värdet, varefter en RTI utförs och programmet fortsätter. 
- D, Delete Breakpoints: 
Tar bort alla definierade brytpunkter från monitorprogrammets tabell. 
- E, Execute Program: 
Används för att starta program på en viss adress, t ex E 0100, vilken går till adress $0100 och startar det program som finns där. Eventuella brytpunkter har dessförinnan placerats in på sina platser. 
- L, Load: 
Ladda minnet med data från kassett. Rutinen förutsätter att ett KCS-modem finns placerat i kontakten J3 på moderkortet. Data följer Motorolas Si-format. Under laddningen visas adress till varje datainspelning på adressindikatorn och varje dataord återges på dataindikatorn. Det innebär, att man vet var i minnet laddning sker och att data verkligen kommer in. Laddningen avslutas när koden S9 kommer in från kassetten, varvid programmet återgår till kontrollslingan. 
- P, Punch Data: 
Spela in data mellan två adresser på kassett. Förutsätter KCS-modem, se ovan. Initieras genom att man efter P anger start- och slutadress för det minnesblock som skall spelas in. Eftersom data sänds så fort sista tecknet har matats in, bör man starta bandspelaren så fort P-tangenten har tryckts ner. Under inspelningen visas adress och data på indikatorerna på samma sätt som vid laddningsfunktionen. När alla data är utmatade, avslutas det hela med koden S9. Att lagra data enligt det här formatet har den stora fördelen att kassetterna kan användas och spelas upp även över andra terminaler utan att man behöver tillgripa specialrutiner. 
- R, Register Display: 
Tangenten visar registren i processorns stack. Först visas på dataindikatorn CC-registret (condition code), med ett tryck på S-knappen visas sedan i tur och ordning B-ackumulatorn, A-ackumula-torn, X-registret, PC-värdet och S-värdet. Vid fortsatt tryckning på S-knappen upprepas det hela och programmet återgår till kontrollslingan med R-knappen. För 6809-utförandet av monitorprogrammet presenteras registren i följande ordning: CC, A, B, DP, X, Y, U, PC och S. Till denna rutin kommer pro-grammet automatiskt vid SWI, NMI och IRQ om RAM-vektorerna för dem ej har ändrats av användaren. Eftersom det kan komma att finnas flera varianter av monitorprogrammen återger vi inga adresser till dem eller andra rutiner. Adresserna framgår dock tydligt av programlistan. Övningsprogram Monitorprogrammet använder RAM-adresserna $A000- AO7F för att lagra konstanter och variabler. Till att göra egna program har man alltså minnesområdet $A080-A3FF fritt. I monitorprogrammet finns rutiner för att exempelvis presentera A-ackumulatorns innehåll på dataindikatorn, för att mata ut ett 16-bitars värde från indexregistret på adressindikatorn och för att hämta in ett tecken från tangentbordet. Rutinerna kan användas i egna program. Det blir därvid ganska enkelt att göra ett program för digitalklocka t ex. Att använda datorn som enbart digitalklocka är dock inte avsikten. Det är ändå en bra övning till att förstå mikroprocessorns arbetssätt och för att lägga en grund till mera avancerad programmering. I nästa avsnitt presenteras KCS-modemet för lagring av data på band.


### Fig 1
![Fig 1](/images/fig1.jpg)

### Fig 2
![Fig 2](/images/fig2.jpg)

### Fig 3
![Fig 3](/images/fig3.jpg)

### Fig 4
![Fig 4](/images/fig4.jpg)

### Fig 5
![Fig 5](/images/fig5.jpg)

Kompletta satser enligt ovan kan beställas från CÅ-Elektronik AB, box 2010, 135 02 Tyresö, tel, 08-XXX XX XX, från Telko i Stockholm, Göteborg och Malmö, samt från Digitronic. En komplett sats med ett monitorprogram kostar 448 kr exkl. moms.  

Ett bygge av en komplett dator kräver följande:  
1 st moderkort typ 800, beskrivet i RT 1980 nr I. Pris 370 kr.  
1 st CPU-kort typ 6819, beskrivet i RT 1979 nr 12. Pris 945 kr.  
1 st indikatorkort typ 8006, beskrivet i detta RT-nummer, pris 448 kr, inklusive monitorprogram för 6808.  
Priserna är inklusive moms.  
Med dessa tre kort och en lämplig nätdel som lämnar +5 V 1,5 A, +12 V 100 mA och -12 V 100 mA har man grunddelarna till ett datorbygge med obegränsade expansionsmöjligheter. En del av de kort som behövs för utbyggnaden har redan beskrivits i RT.  
De är:  
Minneskort 16 k RAM, RT 1978 nr 11.  
Videoterminal, RT 1979 nr 8 och 9.  
Timerkrets och labkort, RT 1980 nr 2.  
Flexskiveanpassning, RT 1980 nr 3.  
I kommande nummer skall ytterligare kort till datorbygget beskrivas. Kort och komponenter till datorserien kan beställas från bl a Telko.  
